import{d as Z,$ as tt,P as et,M as st,a4 as at,n as ot,a1 as nt,l as _,m as it,a3 as R,r as rt,o as v,j as g,q as t,p as x,x as r,V as k,t as i,an as lt,Q as f,F as ct,s as dt,E as S,f as ut,R as ht}from"./index-b34c4227.js";import{b as D}from"./route-block-83d24a4e.js";const pt={class:"bg-base-100 rounded-lg grid sm:grid-cols-1 md:grid-cols-4 p-4"},_t={class:"flex"},vt={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},mt=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-success"},null,-1),gt={class:"font-bold"},ft={class:"text-xs"},bt={class:"flex"},xt={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},kt=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-primary"},null,-1),yt={class:"font-bold"},wt={class:"text-xs"},$t={class:"flex"},St={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},Ct=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-error"},null,-1),Nt={class:"font-bold"},jt={class:"text-xs"},It={class:"flex"},Vt={class:"relative w-9 h-9 rounded overflow-hidden flex items-center justify-center mr-2"},zt=t("div",{class:"absolute top-0 left-0 bottom-0 right-0 opacity-20 bg-error"},null,-1),Et={class:"font-bold"},Pt={class:"text-xs"},Bt={class:"flex items-center justify-between py-1"},Lt={class:"tabs tabs-boxed bg-transparent"},At={class:"text-lg font-semibold"},Tt={class:"bg-base-100 px-4 pt-3 pb-4 rounded shadow"},Ft={class:"overflow-x-auto"},Ot={class:"table staking-table w-full"},Rt={class:"bg-base-200"},Dt={scope:"col",class:"uppercase",style:{width:"3rem",position:"relative"}},Jt={scope:"col",class:"uppercase"},Mt={scope:"col",class:"text-right uppercase"},qt={scope:"col",class:"text-right uppercase"},Ht={scope:"col",class:"text-right uppercase"},Qt={scope:"col",class:"text-center uppercase"},Ut={class:"flex items-center overflow-hidden",style:{"max-width":"300px"}},Wt={class:"avatar mr-4 relative w-8 h-8 rounded-full"},Gt=t("div",{class:"w-8 h-8 rounded-full bg-gray-400 absolute opacity-10"},null,-1),Kt={class:"w-8 h-8 rounded-full"},Xt=["src","onError"],Yt={class:"flex flex-col"},Zt={class:"text-sm text-primary dark:invert whitespace-nowrap overflow-hidden"},te={class:"text-xs"},ee={class:"text-right"},se={class:"flex flex-col"},ae={class:"text-sm font-weight-medium whitespace-nowrap"},oe={class:"text-xs"},ne={class:"text-right text-xs"},ie={class:"text-center"},re={key:0,class:"badge badge-error gap-2 text-white"},le=["onClick"],ce=t("div",{class:"divider"},null,-1),de={class:"flex flex-row items-center"},ue={class:"text-xs truncate relative py-2 px-4 rounded-md w-fit text-error mr-2"},he=t("span",{class:"inset-x-0 inset-y-0 opacity-10 absolute bg-error"},null,-1),pe={class:"text-xs truncate relative py-2 px-4 rounded-md w-fit text-warning"},_e=t("span",{class:"inset-x-0 inset-y-0 opacity-10 absolute bg-warning"},null,-1),ve={class:"text-xs hidden md:!block pl-2"},me=Z({__name:"index",setup(ge){const l=tt(),y=et(),u=st(),J=at(),j=ot(),M=nt(),q=JSON.parse(localStorage.getItem("avatars")||"{}"),m=_(q||{}),w=_({}),I=_({}),d=_("active"),b=_([]),C=_({});it(()=>{l.fetchUnbondingValdiators().then(e=>{b.value=e.concat(b.value)}),l.fetchInacitveValdiators().then(e=>{b.value=b.value.concat(e)}),j.rpc.getSlashingParams().then(e=>{C.value=e.params})});async function H(e=14400){var n,a,c;let s=0,o=Number(((c=(a=(n=y.latest)==null?void 0:n.block)==null?void 0:a.header)==null?void 0:c.height)||0);for(o>e?o-=e:o=1;s<l.validators.length&&o>0;)await y.fetchValidatorByHeight(o,s).then(h=>{h.validators.forEach(p=>{I.value[p.pub_key.key]=Number(p.voting_power)})}),s+=100;for(s=0;s<l.validators.length;)await y.fetchLatestValidators(s).then(h=>{h.validators.forEach(p=>{w.value[p.pub_key.key]=Number(p.voting_power)})}),s+=100}const Q=R(()=>{const e={};return Object.keys(w.value).forEach(s=>{const o=w.value[s]||0,n=I.value[s]||0;e[s]=o-n}),e}),V=e=>{const s=e.consensus_pubkey.key,o=w.value[s];if(!o)return 0;const a=u.tokenAmountNumber({amount:parseInt(e.tokens,10).toString(),denom:l.params.bond_denom})/o;return Q.value[s]*a},U=e=>{if(!e)return"";const s=V(e);return s&&s!==0?u.showChanges(s):""},W=e=>{if(!e)return"";const s=V(e);if(s>0)return"text-success";if(s<0)return"text-error"},G=function(e){var n;let s=0;for(let a=0;a<e;a++)s+=Number((n=l.validators[a])==null?void 0:n.delegator_shares);const o=s/l.totalPower;switch(!0){case(d.value==="active"&&o<.33):return"error";case(d.value==="active"&&o<.67):return"warning";default:return"primary"}};function K(e,s){return!e||!s?!1:e.findIndex(o=>{var n,a,c;return s.website&&((a=s.website)==null?void 0:a.substring(0,(n=s.website)==null?void 0:n.lastIndexOf(".")).endsWith(o))||((c=s==null?void 0:s.moniker)==null?void 0:c.toLowerCase().search(o.toLowerCase()))>-1})>-1}const z=R(()=>{var e,s,o;if(d.value==="active")return l.validators.map((n,a)=>({v:n,rank:G(a),logo:N(n.description.identity)}));if(d.value==="featured"){const n=(o=(s=(e=j.current)==null?void 0:e.endpoints)==null?void 0:s.rest)==null?void 0:o.map(a=>a.provider);return n?(n.push("ping"),l.validators.filter(a=>K(n,a.description)).map((a,c)=>({v:a,rank:"primary",logo:N(a.description.identity)}))):[]}return b.value.map((n,a)=>({v:n,rank:"primary",logo:N(n.description.identity)}))}),E=e=>new Promise(s=>{l.keybase(e).then(o=>{var n,a,c;if(Array.isArray(o.them)&&o.them.length>0){const h=String((c=(a=(n=o.them[0])==null?void 0:n.pictures)==null?void 0:a.primary)==null?void 0:c.url).replace("https://s3.amazonaws.com/keybase_processed_uploads/","");m.value[e]=h,s()}else throw new Error(`failed to fetch avatar for ${e}`)}).catch(o=>{s()})}),X=e=>{E(e).then(()=>{localStorage.setItem("avatars",JSON.stringify(m.value))})},Y=()=>{const e=l.validators.map(s=>{var n;const o=(n=s.description)==null?void 0:n.identity;return o&&!m.value[o]?E(o):Promise.resolve()});Promise.all(e).then(()=>localStorage.setItem("avatars",JSON.stringify(m.value)))},N=e=>{if(!e||!m.value[e])return"";const s=m.value[e]||"";return s.startsWith("http")?s:`https://s3.amazonaws.com/keybase_processed_uploads/${s}`},P=_(!1);return y.$subscribe((e,s)=>{if(s.recents.length>=2&&P.value===!1){P.value=!0;const o=Date.parse(s.recents[1].block.header.time)-Date.parse(s.recents[0].block.header.time),n=Number(s.recents[1].block.header.height)-Number(s.recents[0].block.header.height),a=Number(Number(86400*1e3*n/o).toFixed(0));H(a)}}),Y(),(e,s)=>{var n;const o=rt("RouterLink");return v(),g("div",null,[t("div",pt,[t("div",_t,[t("span",null,[t("div",vt,[x(r(k),{class:"text-success",icon:"mdi:trending-up",size:"32"}),mt])]),t("span",null,[t("div",gt,i(r(u).percent(r(M).inflation)),1),t("div",ft,i(e.$t("staking.inflation")),1)])]),t("div",bt,[t("span",null,[t("div",xt,[x(r(k),{class:"text-primary",icon:"mdi:lock-open-outline",size:"32"}),kt])]),t("span",null,[t("div",yt,i(r(lt)((n=r(l).params)==null?void 0:n.unbonding_time)),1),t("div",wt,i(e.$t("staking.unbonding_time")),1)])]),t("div",$t,[t("span",null,[t("div",St,[x(r(k),{class:"text-error",icon:"mdi:alert-octagon-outline",size:"32"}),Ct])]),t("span",null,[t("div",Nt,i(r(u).percent(C.value.slash_fraction_double_sign)),1),t("div",jt,i(e.$t("staking.double_sign_slashing")),1)])]),t("div",It,[t("span",null,[t("div",Vt,[x(r(k),{class:"text-error",icon:"mdi:pause",size:"32"}),zt])]),t("span",null,[t("div",Et,i(r(u).percent(C.value.slash_fraction_downtime)),1),t("div",Pt,i(e.$t("staking.downtime_slashing")),1)])])]),t("div",null,[t("div",Bt,[t("div",Lt,[t("a",{class:f(["tab text-gray-400",{"tab-active":d.value==="featured"}]),onClick:s[0]||(s[0]=a=>d.value="featured")},i(e.$t("staking.popular")),3),t("a",{class:f(["tab text-gray-400",{"tab-active":d.value==="active"}]),onClick:s[1]||(s[1]=a=>d.value="active")},i(e.$t("staking.active")),3),t("a",{class:f(["tab text-gray-400",{"tab-active":d.value==="inactive"}]),onClick:s[2]||(s[2]=a=>d.value="inactive")},i(e.$t("staking.inactive")),3)]),t("div",At,i(r(z).length)+"/"+i(r(l).params.max_validators),1)]),t("div",Tt,[t("div",Ft,[t("table",Ot,[t("thead",Rt,[t("tr",null,[t("th",Dt,i(e.$t("staking.rank")),1),t("th",Jt,i(e.$t("staking.validator")),1),t("th",Mt,i(e.$t("staking.voting_power")),1),t("th",qt,i(e.$t("staking.24h_changes")),1),t("th",Ht,i(e.$t("staking.commission")),1),t("th",Qt,i(e.$t("staking.actions")),1)])]),t("tbody",null,[(v(!0),g(ct,null,dt(r(z),({v:a,rank:c,logo:h},p)=>{var B,L,A,T;return v(),g("tr",{key:a.operator_address,class:"hover:bg-gray-100 dark:hover:bg-[#384059]"},[t("td",null,[t("div",{class:f(["text-xs truncate relative px-2 py-1 rounded-full w-fit",`text-${c}`])},[t("span",{class:f(["inset-x-0 inset-y-0 opacity-10 absolute",`bg-${c}`])},null,2),S(" "+i(p+1),1)],2)]),t("td",null,[t("div",Ut,[t("div",Wt,[Gt,t("div",Kt,[h?(v(),g("img",{key:0,src:h,class:"object-contain",onError:$=>{var O;const F=(O=a.description)==null?void 0:O.identity;F&&X(F)}},null,40,Xt)):(v(),ut(r(k),{key:1,class:"text-3xl",icon:"mdi-help-circle-outline"}))])]),t("div",Yt,[t("span",Zt,[x(o,{to:{name:"chain-staking-validator",params:{validator:a.operator_address}},class:"font-weight-medium"},{default:ht(()=>{var $;return[S(i(($=a.description)==null?void 0:$.moniker),1)]}),_:2},1032,["to"])]),t("span",te,i(((B=a.description)==null?void 0:B.website)||((L=a.description)==null?void 0:L.identity)||"-"),1)])])]),t("td",ee,[t("div",se,[t("h6",ae,i(r(u).formatToken({amount:parseInt(a.tokens).toString(),denom:r(l).params.bond_denom},!0,"0,0")),1),t("span",oe,i(r(u).calculatePercent(a.delegator_shares,r(l).totalPower)),1)])]),t("td",{class:f(["text-right text-xs",W(a)])},i(U(a)),3),t("td",ne,i(r(u).formatCommissionRate((T=(A=a.commission)==null?void 0:A.commission_rates)==null?void 0:T.rate)),1),t("td",ie,[a.jailed?(v(),g("div",re,i(e.$t("staking.jailed")),1)):(v(),g("label",{key:1,for:"delegate",class:"btn btn-xs btn-primary rounded-sm capitalize",onClick:$=>r(J).open("delegate",{validator_address:a.operator_address})},i(e.$t("account.btn_delegate")),9,le))])])}),128))])])]),ce,t("div",de,[t("div",ue,[he,S(" "+i(e.$t("staking.top"))+" 33% ",1)]),t("div",pe,[_e,S(" "+i(e.$t("staking.top"))+" 67% ",1)]),t("div",ve,i(e.$t("staking.description")),1)])])])])}}});typeof D=="function"&&D(me);export{me as default};
